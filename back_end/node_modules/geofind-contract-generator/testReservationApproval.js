// const EmailSender = require('./src/emailSender');
// const ContractGenerator = require('./src/contractGenerator');
// const path = require('path');

// (async () => {
//     try {
//         console.log("ğŸš€ INICIANDO TEST DE APROBACIÃ“N CON CONTRATO ADJUNTO\n");
        
//         const emailSender = new EmailSender();
//         const contractGenerator = new ContractGenerator();

//         const clientData = {
//             nombre: "Juan PÃ©rez GarcÃ­a",
//             edad: "30",
//             gmail: "juan.perez@email.com",
//             numero_telefonico: "555-123-4567",
//             direccion: "Calle Principal 123, Ciudad de MÃ©xico",
//             curp: "PEGJ800101HDFRRR01",
//            // reference_number: "CTO-2024-001"
//         };

//         const propertyData = {
//             property_address: "Avenida Reforma 456, Polanco, CDMX",
//             property_type: "Departamento",
//             rental_period: "12 meses",
//             monthly_rent: "15000",
//             deposit_amount: "15000",
//             arrendador_nombre: "MarÃ­a GonzÃ¡lez LÃ³pez",
//             bankDetails: {
//                 bank_name: "BBVA Bancomer",
//                 account_number: "4152 3136 5275 1234",
//                 account_holder: "GeoFind Rentas S.A. de C.V.",
//                 clabe: "012180001234567890",
//                 rfc: "GFR240101ABC"
//             },
//             clausulas: [
//                 "1. DURACIÃ“N: El presente contrato tendrÃ¡ una vigencia de 12 meses renovables automÃ¡ticamente.",
//                 "2. RENTA: El pago mensual deberÃ¡ realizarse antes del dÃ­a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secciÃ³n de informaciÃ³n bancaria.",
//                 "3. DEPÃ“SITO: El depÃ³sito en garantÃ­a serÃ¡ equivalente a una mensualidad de renta.",
//                 "4. MANTENIMIENTO: El arrendatario mantendrÃ¡ la propiedad en Ã³ptimas condiciones.",
//                 "5. SERVICIOS: Incluye servicios de agua y mantenimiento de Ã¡reas comunes.",
//                 "1. DURACIÃ“N: El presente contrato tendrÃ¡ una vigencia de 12 meses renovables automÃ¡ticamente.",
//                 "2. RENTA: El pago mensual deberÃ¡ realizarse antes del dÃ­a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secciÃ³n de informaciÃ³n bancaria.",
//                 "3. DEPÃ“SITO: El depÃ³sito en garantÃ­a serÃ¡ equivalente a una mensualidad de renta.",
//                 "4. MANTENIMIENTO: El arrendatario mantendrÃ¡ la propiedad en Ã³ptimas condiciones.",
//                 "5. SERVICIOS: Incluye servicios de agua y mantenimiento de Ã¡reas comunes.",
//                 "1. DURACIÃ“N: El presente contrato tendrÃ¡ una vigencia de 12 meses renovables automÃ¡ticamente.",
//                 "2. RENTA: El pago mensual deberÃ¡ realizarse antes del dÃ­a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secciÃ³n de informaciÃ³n bancaria.",
//                 "3. DEPÃ“SITO: El depÃ³sito en garantÃ­a serÃ¡ equivalente a una mensualidad de renta.",
//                 "4. MANTENIMIENTO: El arrendatario mantendrÃ¡ la propiedad en Ã³ptimas condiciones.",
//                 "5. SERVICIOS: Incluye servicios de agua y mantenimiento de Ã¡reas comunes."
//             ]
//         };

//         console.log("ğŸ“„ Generando contrato...");
//         const contractPath = await contractGenerator.generateRentalContract(clientData, propertyData);
//         console.log(`âœ… Contrato generado: ${contractPath}`);

//         const recipientEmail = "31loredo@gmail.com";
//         const clientName = "Juan PÃ©rez GarcÃ­a";
//         const contractDetails = {
//             property_name: "Departamento de Lujo en Polanco",
//             property_address: "Avenida Reforma 456, Polanco, CDMX",
//             period: "12 meses (Nov 2024 - Oct 2025)",
//             price: "15000",
//             contract_number: "CTO-2024-001"
//         };
        
//         const bankDetails = {
//             bank_name: "BBVA Bancomer",
//             account_number: "4152 3136 5275 1234",
//             account_holder: "GeoFind Rentas S.A. de C.V.",
//             clabe: "012180001234567890"
//         };

//         console.log("\nğŸ“§ Enviando correo de aprobaciÃ³n con contrato adjunto...");
//         console.log(`ğŸ“ Destinatario: ${recipientEmail}`);
//         console.log(`ğŸ“ Contrato a adjuntar: ${path.basename(contractPath)}`);

//         const [success, info] = await emailSender.sendAcceptanceEmail(
//             recipientEmail,
//             clientName,
//             contractDetails,
//             bankDetails,
//             contractPath
//         );

//         console.log("\n" + "=".repeat(60));
//         if (success) {
//             console.log("ğŸ‰ TEST DE APROBACIÃ“N EXITOSO");
//             console.log(`âœ… ${info}`);
//             console.log(`ğŸ“§ Correo enviado a: ${recipientEmail}`);
//             console.log(`ğŸ“ Contrato adjuntado: SÃ­`);
//             console.log(`ğŸ¦ Datos bancarios incluidos: SÃ­`);
//             console.log(`ğŸ“„ SecciÃ³n bancaria en contrato: SÃ­`);
//         } else {
//             console.log("âŒ TEST DE APROBACIÃ“N FALLIDO");
//             console.log(`âŒ ${info}`);
//         }
//         console.log("=".repeat(60));

//     } catch (err) {
//         console.error("\nğŸ’¥ ERROR EN TEST DE APROBACIÃ“N:");
//         console.error(err.message);
//         console.error(err.stack);
//     }
// })();




const EmailSender = require('./src/emailSender');
const ContractGenerator = require('./src/contractGenerator');
const path = require('path');

(async () => {
    try {
        console.log("ğŸš€ INICIANDO TEST DE APROBACIÃ“N CON CONTRATO ADJUNTO\n");
        
        const emailSender = new EmailSender();
        const contractGenerator = new ContractGenerator();

        const clientData = {
            nombre: "Juan PÃ©rez GarcÃ­a",
            edad: "30",
            gmail: "juan.perez@email.com",
            numero_telefonico: "555-123-4567",
            direccion: "Calle Principal 123, Ciudad de MÃ©xico",
            curp: "PEGJ800101HDFRRR01",
           // reference_number: "CTO-2024-001"
        };

        const propertyData = {
            property_address: "Avenida Reforma 456, Polanco, CDMX",
            property_type: "Departamento",
            rental_period: "12 meses",
            monthly_rent: "15000",
            deposit_amount: "15000",
            arrendador_nombre: "MarÃ­a GonzÃ¡lez LÃ³pez",
            bankDetails: {
                bank_name: "BBVA Bancomer",
                account_number: "4152 3136 5275 1234",
                account_holder: "GeoFind Rentas S.A. de C.V.",
                clabe: "012180001234567890",
                rfc: "GFR240101ABC"
            },
            clausulas: [
                "1. DURACIÃ“N: El presente contrato tendrÃ¡ una vigencia de 12 meses renovables automÃ¡ticamente.",
                "2. RENTA: El pago mensual deberÃ¡ realizarse antes del dÃ­a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secciÃ³n de informaciÃ³n bancaria.",
                "3. DEPÃ“SITO: El depÃ³sito en garantÃ­a serÃ¡ equivalente a una mensualidad de renta.",
                "4. MANTENIMIENTO: El arrendatario mantendrÃ¡ la propiedad en Ã³ptimas condiciones.",
                "5. SERVICIOS: Incluye servicios de agua y mantenimiento de Ã¡reas comunes.",
                "1. DURACIÃ“N: El presente contrato tendrÃ¡ una vigencia de 12 meses renovables automÃ¡ticamente.",
                "2. RENTA: El pago mensual deberÃ¡ realizarse antes del dÃ­a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secciÃ³n de informaciÃ³n bancaria.",
                "3. DEPÃ“SITO: El depÃ³sito en garantÃ­a serÃ¡ equivalente a una mensualidad de renta.",
                "4. MANTENIMIENTO: El arrendatario mantendrÃ¡ la propiedad en Ã³ptimas condiciones.",
                "5. SERVICIOS: Incluye servicios de agua y mantenimiento de Ã¡reas comunes.",
                "1. DURACIÃ“N: El presente contrato tendrÃ¡ una vigencia de 12 meses renovables automÃ¡ticamente.",
                "2. RENTA: El pago mensual deberÃ¡ realizarse antes del dÃ­a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secciÃ³n de informaciÃ³n bancaria.",
                "3. DEPÃ“SITO: El depÃ³sito en garantÃ­a serÃ¡ equivalente a una mensualidad de renta.",
                "4. MANTENIMIENTO: El arrendatario mantendrÃ¡ la propiedad en Ã³ptimas condiciones.",
                "5. SERVICIOS: Incluye servicios de agua y mantenimiento de Ã¡reas comunes."
            ]
        };

        console.log("ğŸ“„ Generando contrato...");
        const contractPath = await contractGenerator.generateRentalContract(clientData, propertyData);
        console.log(`âœ… Contrato generado: ${contractPath}`);

        const recipientEmail = "31loredo@gmail.com";
        const clientName = "Juan PÃ©rez GarcÃ­a";
        const contractDetails = {
            property_name: "Departamento de Lujo en Polanco",
            property_address: "Avenida Reforma 456, Polanco, CDMX",
            map_property: "https://maps.app.goo.gl/yb9XooritqWpmYBx8",
            period: "12 meses (Nov 2024 - Oct 2025)",
            price: "15000",
            contract_number: "CTO-2024-001"
        };
        
        const bankDetails = {
            bank_name: "BBVA Bancomer",
            account_number: "4152 3136 5275 1234",
            account_holder: "GeoFind Rentas S.A. de C.V.",
            clabe: "012180001234567890"
        };

        console.log("\nğŸ“§ Enviando correo de aprobaciÃ³n con contrato adjunto...");
        console.log(`ğŸ“ Destinatario: ${recipientEmail}`);
        console.log(`ğŸ“ Contrato a adjuntar: ${path.basename(contractPath)}`);
        console.log(`ğŸ—ºï¸ URL de Google Maps: ${contractDetails.map_property}`);

        const [success, info] = await emailSender.sendAcceptanceEmail(
            recipientEmail,
            clientName,
            contractDetails,
            bankDetails,
            contractPath
        );

        console.log("\n" + "=".repeat(60));
        if (success) {
            console.log("ğŸ‰ TEST DE APROBACIÃ“N EXITOSO");
            console.log(`âœ… ${info}`);
            console.log(`ğŸ“§ Correo enviado a: ${recipientEmail}`);
            console.log(`ğŸ“ Contrato adjuntado: SÃ­`);
            console.log(`ğŸ¦ Datos bancarios incluidos: SÃ­`);
            console.log(`ğŸ—ºï¸ URL Google Maps incluida: SÃ­`);
            console.log(`ğŸ“„ SecciÃ³n bancaria en contrato: SÃ­`);
        } else {
            console.log("âŒ TEST DE APROBACIÃ“N FALLIDO");
            console.log(`âŒ ${info}`);
        }
        console.log("=".repeat(60));

    } catch (err) {
        console.error("\nğŸ’¥ ERROR EN TEST DE APROBACIÃ“N:");
        console.error(err.message);
        console.error(err.stack);
    }
})();