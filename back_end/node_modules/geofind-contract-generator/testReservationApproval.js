// const EmailSender = require('./src/emailSender');
// const ContractGenerator = require('./src/contractGenerator');
// const path = require('path');

// (async () => {
//     try {
//         console.log("üöÄ INICIANDO TEST DE APROBACI√ìN CON CONTRATO ADJUNTO\n");
        
//         const emailSender = new EmailSender();
//         const contractGenerator = new ContractGenerator();

//         const clientData = {
//             nombre: "Juan P√©rez Garc√≠a",
//             edad: "30",
//             gmail: "juan.perez@email.com",
//             numero_telefonico: "555-123-4567",
//             direccion: "Calle Principal 123, Ciudad de M√©xico",
//             curp: "PEGJ800101HDFRRR01",
//            // reference_number: "CTO-2024-001"
//         };

//         const propertyData = {
//             property_address: "Avenida Reforma 456, Polanco, CDMX",
//             property_type: "Departamento",
//             rental_period: "12 meses",
//             monthly_rent: "15000",
//             deposit_amount: "15000",
//             arrendador_nombre: "Mar√≠a Gonz√°lez L√≥pez",
//             bankDetails: {
//                 bank_name: "BBVA Bancomer",
//                 account_number: "4152 3136 5275 1234",
//                 account_holder: "GeoFind Rentas S.A. de C.V.",
//                 clabe: "012180001234567890",
//                 rfc: "GFR240101ABC"
//             },
//             clausulas: [
//                 "1. DURACI√ìN: El presente contrato tendr√° una vigencia de 12 meses renovables autom√°ticamente.",
//                 "2. RENTA: El pago mensual deber√° realizarse antes del d√≠a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secci√≥n de informaci√≥n bancaria.",
//                 "3. DEP√ìSITO: El dep√≥sito en garant√≠a ser√° equivalente a una mensualidad de renta.",
//                 "4. MANTENIMIENTO: El arrendatario mantendr√° la propiedad en √≥ptimas condiciones.",
//                 "5. SERVICIOS: Incluye servicios de agua y mantenimiento de √°reas comunes.",
//                 "1. DURACI√ìN: El presente contrato tendr√° una vigencia de 12 meses renovables autom√°ticamente.",
//                 "2. RENTA: El pago mensual deber√° realizarse antes del d√≠a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secci√≥n de informaci√≥n bancaria.",
//                 "3. DEP√ìSITO: El dep√≥sito en garant√≠a ser√° equivalente a una mensualidad de renta.",
//                 "4. MANTENIMIENTO: El arrendatario mantendr√° la propiedad en √≥ptimas condiciones.",
//                 "5. SERVICIOS: Incluye servicios de agua y mantenimiento de √°reas comunes.",
//                 "1. DURACI√ìN: El presente contrato tendr√° una vigencia de 12 meses renovables autom√°ticamente.",
//                 "2. RENTA: El pago mensual deber√° realizarse antes del d√≠a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secci√≥n de informaci√≥n bancaria.",
//                 "3. DEP√ìSITO: El dep√≥sito en garant√≠a ser√° equivalente a una mensualidad de renta.",
//                 "4. MANTENIMIENTO: El arrendatario mantendr√° la propiedad en √≥ptimas condiciones.",
//                 "5. SERVICIOS: Incluye servicios de agua y mantenimiento de √°reas comunes."
//             ]
//         };

//         console.log("üìÑ Generando contrato...");
//         const contractPath = await contractGenerator.generateRentalContract(clientData, propertyData);
//         console.log(`‚úÖ Contrato generado: ${contractPath}`);

//         const recipientEmail = "31loredo@gmail.com";
//         const clientName = "Juan P√©rez Garc√≠a";
//         const contractDetails = {
//             property_name: "Departamento de Lujo en Polanco",
//             property_address: "Avenida Reforma 456, Polanco, CDMX",
//             period: "12 meses (Nov 2024 - Oct 2025)",
//             price: "15000",
//             contract_number: "CTO-2024-001"
//         };
        
//         const bankDetails = {
//             bank_name: "BBVA Bancomer",
//             account_number: "4152 3136 5275 1234",
//             account_holder: "GeoFind Rentas S.A. de C.V.",
//             clabe: "012180001234567890"
//         };

//         console.log("\nüìß Enviando correo de aprobaci√≥n con contrato adjunto...");
//         console.log(`üìç Destinatario: ${recipientEmail}`);
//         console.log(`üìé Contrato a adjuntar: ${path.basename(contractPath)}`);

//         const [success, info] = await emailSender.sendAcceptanceEmail(
//             recipientEmail,
//             clientName,
//             contractDetails,
//             bankDetails,
//             contractPath
//         );

//         console.log("\n" + "=".repeat(60));
//         if (success) {
//             console.log("üéâ TEST DE APROBACI√ìN EXITOSO");
//             console.log(`‚úÖ ${info}`);
//             console.log(`üìß Correo enviado a: ${recipientEmail}`);
//             console.log(`üìé Contrato adjuntado: S√≠`);
//             console.log(`üè¶ Datos bancarios incluidos: S√≠`);
//             console.log(`üìÑ Secci√≥n bancaria en contrato: S√≠`);
//         } else {
//             console.log("‚ùå TEST DE APROBACI√ìN FALLIDO");
//             console.log(`‚ùå ${info}`);
//         }
//         console.log("=".repeat(60));

//     } catch (err) {
//         console.error("\nüí• ERROR EN TEST DE APROBACI√ìN:");
//         console.error(err.message);
//         console.error(err.stack);
//     }
// })();




const EmailSender = require('./src/emailSender');
const ContractGenerator = require('./src/contractGenerator');
const path = require('path');

(async () => {
    try {
        console.log("üöÄ INICIANDO TEST DE APROBACI√ìN CON CONTRATO ADJUNTO\n");
        
        const emailSender = new EmailSender();
        const contractGenerator = new ContractGenerator();

        const clientData = {
            nombre: "Juan P√©rez Garc√≠a",
            edad: "30",
            gmail: "juan.perez@email.com",
            numero_telefonico: "555-123-4567",
            direccion: "Calle Principal 123, Ciudad de M√©xico",
            curp: "PEGJ800101HDFRRR01",
           // reference_number: "CTO-2024-001"
        };

        const propertyData = {
            property_address: "Avenida Reforma 456, Polanco, CDMX",
            property_type: "Departamento",
            rental_period: "12 meses",
            monthly_rent: "15000",
            deposit_amount: "15000",
            arrendador_nombre: "Mar√≠a Gonz√°lez L√≥pez",
            bankDetails: {
                bank_name: "BBVA Bancomer",
                account_number: "4152 3136 5275 1234",
                account_holder: "GeoFind Rentas S.A. de C.V.",
                clabe: "012180001234567890",
                rfc: "GFR240101ABC"
            },
            clausulas: [
                "1. DURACI√ìN: El presente contrato tendr√° una vigencia de 12 meses renovables autom√°ticamente.",
                "2. RENTA: El pago mensual deber√° realizarse antes del d√≠a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secci√≥n de informaci√≥n bancaria.",
                "3. DEP√ìSITO: El dep√≥sito en garant√≠a ser√° equivalente a una mensualidad de renta.",
                "4. MANTENIMIENTO: El arrendatario mantendr√° la propiedad en √≥ptimas condiciones.",
                "5. SERVICIOS: Incluye servicios de agua y mantenimiento de √°reas comunes.",
                "1. DURACI√ìN: El presente contrato tendr√° una vigencia de 12 meses renovables autom√°ticamente.",
                "2. RENTA: El pago mensual deber√° realizarse antes del d√≠a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secci√≥n de informaci√≥n bancaria.",
                "3. DEP√ìSITO: El dep√≥sito en garant√≠a ser√° equivalente a una mensualidad de renta.",
                "4. MANTENIMIENTO: El arrendatario mantendr√° la propiedad en √≥ptimas condiciones.",
                "5. SERVICIOS: Incluye servicios de agua y mantenimiento de √°reas comunes.",
                "1. DURACI√ìN: El presente contrato tendr√° una vigencia de 12 meses renovables autom√°ticamente.",
                "2. RENTA: El pago mensual deber√° realizarse antes del d√≠a 5 de cada mes mediante transferencia bancaria a la cuenta indicada en la secci√≥n de informaci√≥n bancaria.",
                "3. DEP√ìSITO: El dep√≥sito en garant√≠a ser√° equivalente a una mensualidad de renta.",
                "4. MANTENIMIENTO: El arrendatario mantendr√° la propiedad en √≥ptimas condiciones.",
                "5. SERVICIOS: Incluye servicios de agua y mantenimiento de √°reas comunes."
            ]
        };

        console.log("üìÑ Generando contrato...");
        const contractPath = await contractGenerator.generateRentalContract(clientData, propertyData);
        console.log(`‚úÖ Contrato generado: ${contractPath}`);

        const recipientEmail = "31loredo@gmail.com";
        const clientName = "Juan P√©rez Garc√≠a";
        const contractDetails = {
            property_name: "Departamento de Lujo en Polanco",
            property_address: "Avenida Reforma 456, Polanco, CDMX",
            map_property: "https://maps.app.goo.gl/yb9XooritqWpmYBx8",
            period: "12 meses (Nov 2024 - Oct 2025)",
            price: "15000",
            contract_number: "CTO-2024-001"
        };
        
        const bankDetails = {
            bank_name: "BBVA Bancomer",
            account_number: "4152 3136 5275 1234",
            account_holder: "GeoFind Rentas S.A. de C.V.",
            clabe: "012180001234567890"
        };

        console.log("\nüìß Enviando correo de aprobaci√≥n con contrato adjunto...");
        console.log(`üìç Destinatario: ${recipientEmail}`);
        console.log(`üìé Contrato a adjuntar: ${path.basename(contractPath)}`);
        console.log(`üó∫Ô∏è URL de Google Maps: ${contractDetails.map_property}`);

        const [success, info] = await emailSender.sendAcceptanceEmail(
            recipientEmail,
            clientName,
            contractDetails,
            bankDetails,
            contractPath
        );

        console.log("\n" + "=".repeat(60));
        if (success) {
            console.log("üéâ TEST DE APROBACI√ìN EXITOSO");
            console.log(`‚úÖ ${info}`);
            console.log(`üìß Correo enviado a: ${recipientEmail}`);
            console.log(`üìé Contrato adjuntado: S√≠`);
            console.log(`üè¶ Datos bancarios incluidos: S√≠`);
            console.log(`üó∫Ô∏è URL Google Maps incluida: S√≠`);
            console.log(`üìÑ Secci√≥n bancaria en contrato: S√≠`);
        } else {
            console.log("‚ùå TEST DE APROBACI√ìN FALLIDO");
            console.log(`‚ùå ${info}`);
        }
        console.log("=".repeat(60));

    } catch (err) {
        console.error("\nüí• ERROR EN TEST DE APROBACI√ìN:");
        console.error(err.message);
        console.error(err.stack);
    }
})();